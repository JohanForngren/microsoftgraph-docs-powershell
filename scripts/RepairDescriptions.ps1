$RetainedExamples = New-Object Collections.Generic.List[string] 
function Import-Descriptions {
    Param (
        [object]$Content,
        [string]$File
    ) 
    $SearchBlock = "## EXAMPLES(?s).*## PARAMETERS"
    $SearchBlock2 = "## DESCRIPTION(?s).*## PARAMETERS"
    $option = [System.Text.RegularExpressions.RegexOptions]::Multiline
    $Re = [regex]::new($SearchBlock, $option)
    $Re2 = [regex]::new($SearchBlock2, $option)
   
    $End = 0
    $NoOfExamples = 0
    foreach ($C in $Content) {
        if ($C.StartsWith("### Example")) {
            $NoOfExamples++
        }
        $End++  
    }
   
    Write-Host "Retianed examples $NoOfExamples"
    Get-ExistingDescriptions -Content $Content -File $File  -start 0 -end $End -NoOfExamples $NoOfExamples
    Write-Host "File " $File
    if(Test-Path $File){
        Write-Host "Importing descriptions " $RetainedExamples.Count
    $TitleCount = 1
    $DestinationContent = Get-Content -Encoding UTF8 -Raw $File
    $RetainedContent = $null
    foreach ($Ex in $RetainedExamples) {
            $ContentBody = $Ex.Split("**##@**")[0]
            Write-Host $ContentBody
            $ContentDescription = $Ex.Split("**##@**")[2]
            $RetainedContent += "$ContentBody$ContentDescription"  
            $TitleCount++ 
                        
    }

   
    if(-not($Null -eq $RetainedContent) -and -not($RetainedContent.Contains("Add title here"))){
     if($DestinationContent -match $Re){
        $Extracted = $Matches[0]
        Write-Host 
        $FinalOutput = "## EXAMPLES`r`n$RetainedContent`r`n## PARAMETERS"
        $text = $DestinationContent.ToString()
        if(-not($Extracted.Contains("### EXAMPLE"))){
            $text = $text.Replace($Extracted, "## PARAMETERS") 
            Write-Host "Does not have snippetsing"
        }else{
            $text = $text.Replace($Extracted, $FinalOutput)
        }
          $text | Out-File $File -Encoding UTF8
     }
     if($DestinationContent -match $Re2){
        $Extracted2 = $Matches[0]
        $DescriptionCommand = [System.IO.Path]::GetFileNameWithoutExtension($File)
        $Description1 = "This example shows how to use the $DescriptionCommand Cmdlet."
        $Description2 = "To learn about permissions for this resource, see the [permissions reference](/graph/permissions-reference)."
      
        $text2 = $DestinationContent.ToString()
        if(-not($Extracted2.Contains("## EXAMPLES"))){
            Write-Host "Does not have snippet $DescriptionCommand"
            $text2 = $text2.Replace($Description1, $null)
            $text2 = $text2.Replace($Description2, $null)
            $text2 | Out-File $File -Encoding UTF8

        }
     }
     $Stream = [IO.File]::OpenWrite($File)
     try
     {
         $Stream.SetLength($stream.Length - 2)
         $Stream.Close()
     }
     catch
     {
         
     }
     $Stream.Dispose()
     $RetainedExamples.Clear()
    }
    
}
    
}
function Get-ExistingDescriptions {

    Param (
        [object]$Content,
        [string]$File,
        [string]$CommandPattern,
        [int]$Start,
        [int]$End,
        [int]$NoOfExamples
    )
    $Title = $null
    $ContentBlock = $null
    
    for ($i = $Start; $i -lt $End; $i++) {
        $Value = $Content[$i]
        $ContentBlock += "$Value`n" 
        
        if ($Content[$i].StartsWith("### Example")) {
            $Title = $Content[$i]
            
        }   
        if ($Content[$i].EndsWith("``")) {
            $Start = $i
            break;
        }
    }
    $RetainedDescription = $null
    for ($j = $Start + 1; $j -lt $end; $j++) {
       
        if ($Content[$j].StartsWith("### Example")) {
            break;
        }
        $DescVal = $Content[$j]
        $RetainedDescription += "$DescVal`n"
    }
    $RetainedExamples.Add("$ContentBlock**##@**$Title**##@**$RetainedDescription")
    if ($NoOfExamples -gt 1) {
        $NoOfExamples--
        for ($k = $Start; $k -lt $End; $k++) {
            if ($Content[$k].StartsWith("### Example")) {
                $Start = $k
                break;
            }
        }
      
        Get-ExistingDescriptions -Content $Content -File $File -start $Start -end $End -NoOfExamples $NoOfExamples
    }
   
}
$File = "C:\Projects\msgraph-sdk-powershell\src\Teams\beta\examples\Update-MgBetaTeamworkTeamAppSetting.md"
$DestinationFile = "C:\Projects\microsoftgraph-docs-powershell\microsoftgraph\graph-powershell-beta\Microsoft.Graph.Beta.Teams\Update-MgBetaTeamworkTeamAppSetting.md"
$Content = Get-Content -Path $File
Write-Host $RetainedExamples.Count
Import-Descriptions -Content $Content -File $DestinationFile